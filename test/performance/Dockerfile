FROM golang:1.21

ARG XK6_VERSION=v0.12.2

ENV BASE_URL ""
ENV STAGE_DURATION 30

ENV AVERAGE_LOAD_ITER_PER_SEC 15
ENV AVERAGE_LOAD_ITER_VARIATION 5
ENV AVERAGE_LOAD_DURATION_95 500

ENV AUTOSCALING_MAX_ITER_PER_SEC 20
ENV AUTOSCALING_DURATION_95 500

ENV STRESS_LOAD_MIN_ITER_PER_SEC 10
ENV STRESS_LOAD_MAX_ITER_PER_SEC 50
ENV STRESS_LOAD_DURATION_95 500

WORKDIR /app

RUN go install go.k6.io/xk6/cmd/xk6@${XK6_VERSION}
RUN xk6 build ${XK6_VERSION}
RUN mv /app/k6 /usr/bin

COPY common.js autoscaling.js stressload.js average-load.js /app/

CMD ["k6", "run", "/app/average-load.js"]
